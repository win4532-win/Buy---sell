<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• - ShopZone</title>
    <meta name="description" content="‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö ShopZone">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/pages.css">
</head>

<body>
    <!-- Header -->
    <div id="header-placeholder"></div>

    <main class="admin-page">
        <div class="container">
            <!-- Admin Header -->
            <div class="admin-header animate-fade">
                <div class="flex-between flex-wrap gap-4">
                    <div>
                        <h1 class="text-3xl font-bold">üõ°Ô∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h1>
                        <p class="text-muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                    </div>
                    <div>
                        <span class="badge badge-warning" style="font-size:1rem;padding:0.75rem 1.5rem">
                            üë§ ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
                        </span>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-4 gap-6 mb-8">
                <div class="card p-6 text-center hover-lift">
                    <div class="text-4xl mb-3">üë•</div>
                    <div class="stat-value text-primary" id="total-customers">0</div>
                    <div class="stat-label">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="card p-6 text-center hover-lift">
                    <div class="text-4xl mb-3">üì¶</div>
                    <div class="stat-value text-primary" id="total-orders">0</div>
                    <div class="stat-label">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
                </div>
                <div class="card p-6 text-center hover-lift">
                    <div class="text-4xl mb-3">üí∞</div>
                    <div class="stat-value text-primary" id="total-revenue">‡∏ø0</div>
                    <div class="stat-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°</div>
                </div>
                <div class="card p-6 text-center hover-lift">
                    <div class="text-4xl mb-3">üõçÔ∏è</div>
                    <div class="stat-value text-primary" id="total-products">4</div>
                    <div class="stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                </div>
            </div>

            <!-- Members Section -->
            <section class="mb-8">
                <div class="flex-between mb-4">
                    <h2 class="text-xl font-bold">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
                    <button class="btn btn-secondary btn-sm" onclick="refreshData()">
                        üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                    <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                                    <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody id="customers-table">
                                <!-- Customers will be rendered here -->
                            </tbody>
                        </table>
                    </div>

                    <div id="no-customers" class="text-center py-8" style="display:none">
                        <div class="text-4xl mb-4">üì≠</div>
                        <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                        <p class="text-sm text-muted mt-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
                    </div>
                </div>
            </section>

            <!-- Recent Orders Section -->
            <section class="mb-8">
                <h2 class="text-xl font-bold mb-4">üì¶ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>

                <div class="card">
                    <div class="table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™</th>
                                    <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                    <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table">
                                <!-- Orders will be rendered here -->
                            </tbody>
                        </table>
                    </div>

                    <div id="no-orders" class="text-center py-8" style="display:none">
                        <div class="text-4xl mb-4">üì≠</div>
                        <p class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="mb-8">
                <h2 class="text-xl font-bold mb-4">‚ö° ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h2>
                <div class="grid grid-4 gap-4">
                    <button class="card p-6 text-center hover-lift" onclick="exportCustomers()">
                        <div class="text-3xl mb-3">üìä</div>
                        <span class="font-medium">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
                    </button>
                    <a href="index.html" class="card p-6 text-center hover-lift">
                        <div class="text-3xl mb-3">üè™</div>
                        <span class="font-medium">‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</span>
                    </a>
                    <button class="card p-6 text-center hover-lift" onclick="clearDemoData()">
                        <div class="text-3xl mb-3">üóëÔ∏è</div>
                        <span class="font-medium">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Demo</span>
                    </button>
                    <button class="card p-6 text-center hover-lift" onclick="logout()">
                        <div class="text-3xl mb-3">üö™</div>
                        <span class="font-medium">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

    <!-- JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/components.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Check admin access
        document.addEventListener('DOMContentLoaded', () => {
            if (!isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }

            if (!isAdmin()) {
                showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ', 'error');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
                return;
            }

            // Load data
            loadDashboardData();
            loadCustomersList();
            loadOrdersList();
        });

        // Load dashboard statistics
        function loadDashboardData() {
            const customers = getAllCustomers();
            const orders = getAllOrders();

            document.getElementById('total-customers').textContent = customers.length;
            document.getElementById('total-orders').textContent = orders.length;

            // Calculate revenue
            const revenue = getTotalRevenue();
            document.getElementById('total-revenue').textContent = formatPrice(revenue);
        }

        // Load customers list
        function loadCustomersList() {
            const customers = getAllCustomers();
            const tbody = document.getElementById('customers-table');
            const noCustomers = document.getElementById('no-customers');

            if (customers.length === 0) {
                tbody.innerHTML = '';
                noCustomers.style.display = 'block';
                return;
            }

            noCustomers.style.display = 'none';

            tbody.innerHTML = customers.map((customer, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>
                        <div class="flex gap-3 align-center">
                            <div class="avatar-sm">${(customer.name || '‡∏•')[0].toUpperCase()}</div>
                            <span>${customer.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
                        </div>
                    </td>
                    <td>${customer.phone || '-'}</td>
                    <td>${customer.province || customer.address?.slice(0, 20) || '-'}</td>
                    <td>${formatDateShort(customer.lastOrder || customer.registeredAt)}</td>
                    <td class="text-center"><span class="badge badge-primary">${customer.orderCount || 1}</span></td>
                    <td>
                        <span class="badge badge-success">‚úì ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß</span>
                    </td>
                </tr>
            `).join('');
        }

        // Load orders list
        function loadOrdersList() {
            const orders = getAllOrders();
            const tbody = document.getElementById('orders-table');
            const noOrders = document.getElementById('no-orders');

            if (orders.length === 0) {
                tbody.innerHTML = '';
                noOrders.style.display = 'block';
                return;
            }

            noOrders.style.display = 'none';

            tbody.innerHTML = orders.slice(-10).reverse().map(order => `
                <tr>
                    <td><strong>#${order.id}</strong></td>
                    <td>${order.customerName || '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤'}</td>
                    <td>${order.items?.length || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                    <td class="font-medium text-primary">${formatPrice(order.total || 0)}</td>
                    <td>${formatDateShort(order.createdAt)}</td>
                    <td>
                        <span class="badge ${order.status === 'completed' ? 'badge-success' : 'badge-warning'}">
                            ${order.status === 'completed' ? '‚úì ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // Refresh data
        function refreshData() {
            loadDashboardData();
            loadCustomersList();
            loadOrdersList();
            showToast('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        // Export customers to CSV
        function exportCustomers() {
            const customers = getAllCustomers();

            if (customers.length === 0) {
                showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
                return;
            }

            // Create CSV content
            let csv = '‡∏•‡∏≥‡∏î‡∏±‡∏ö,‡∏ä‡∏∑‡πà‡∏≠,‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£,‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà,‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á\n';

            customers.forEach((customer, index) => {
                csv += `${index + 1},"${customer.name || ''}","${customer.phone || ''}","${customer.address || ''}","${customer.province || ''}","${customer.postcode || ''}","${customer.lastOrder || customer.registeredAt || ''}",${customer.orderCount || 1}\n`;
            });

            // Download CSV
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'customers_' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();

            showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Clear demo data
        function clearDemoData() {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Demo ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Admin)')) {
                localStorage.removeItem('customers');
                localStorage.removeItem('allOrders');
                localStorage.removeItem('cart');
                loadDashboardData();
                loadCustomersList();
                loadOrdersList();
                showToast('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        // Format date short
        function formatDateShort(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('th-TH', {
                day: 'numeric',
                month: 'short',
                year: '2-digit'
            });
        }
    </script>

    <style>
        .admin-page {
            padding: var(--spacing-8) 0;
            min-height: calc(100vh - 200px);
            background: var(--color-gray-50);
        }

        .admin-header {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            padding: var(--spacing-8);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-8);
        }

        .admin-header h1,
        .admin-header p {
            color: white;
        }

        .table-container {
            overflow-x: auto;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: var(--spacing-4);
            text-align: left;
            border-bottom: 1px solid var(--color-gray-100);
        }

        .admin-table th {
            background: var(--color-gray-50);
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--color-text-muted);
        }

        .admin-table tr:hover {
            background: var(--color-gray-50);
        }

        .avatar-sm {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .badge-info {
            background: #e3f2fd;
            color: #1976d2;
        }

        @media (max-width: 768px) {
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</body>

</html>